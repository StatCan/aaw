
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Developer Docs">
      
      
      
        <link rel="canonical" href="https://statcan.github.io/aaw/en/features/netapp-mounting/overview/">
      
      
        <link rel="prev" href="../../source-control/gitea/">
      
      
        <link rel="next" href="../../../resources/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.42">
    
    
      
        <title>Netapp (Filer) Mounting - AAW Dev Docs</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.0253249f.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="yellow" data-md-color-accent="blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#netapp-or-filer-mounting" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="AAW Dev Docs" class="md-header__button md-logo" aria-label="AAW Dev Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            AAW Dev Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Netapp (Filer) Mounting
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/StatCan/aaw" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    StatCan/aaw
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="AAW Dev Docs" class="md-nav__button md-logo" aria-label="AAW Dev Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    AAW Dev Docs
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/StatCan/aaw" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    StatCan/aaw
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" checked>
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Features
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            Features
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../getting-started/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Getting Started
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_3" >
        
          
          <label class="md-nav__link" for="__nav_1_3" id="__nav_1_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Object Storage
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_3">
            <span class="md-nav__icon md-icon"></span>
            Object Storage
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../object-storage/s3proxy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    S3Proxy and S3 Explorer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../object-storage/blobcsi/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Blob CSI
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud-main-connectivity/cloud-main-connectivity/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cloud Main Connectivity
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../data-virtualization/trino/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Data Virtualization
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_6" >
        
          
          <label class="md-nav__link" for="__nav_1_6" id="__nav_1_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    RBAC
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_6">
            <span class="md-nav__icon md-icon"></span>
            RBAC
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../rbac/non-employee-rbac/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Non-Employee RBAC
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../source-control/gitea/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Source Control
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Netapp (Filer) Mounting
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Netapp (Filer) Mounting
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#what-is-netapp-in-relation-to-our-legacy-filers" class="md-nav__link">
    <span class="md-ellipsis">
      What is NetApp in relation to our legacy filers?
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#integration-with-netapp" class="md-nav__link">
    <span class="md-ellipsis">
      Integration with NetApp
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Integration with NetApp">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#why-do-we-need-to-modify-goofys" class="md-nav__link">
    <span class="md-ellipsis">
      Why do we need to modify goofys?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deployment-checklist" class="md-nav__link">
    <span class="md-ellipsis">
      Deployment Checklist
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-metafuse-daemonset-and-driver" class="md-nav__link">
    <span class="md-ellipsis">
      The metafuse daemonset and driver
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deployment-checklist_1" class="md-nav__link">
    <span class="md-ellipsis">
      Deployment checklist
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#controllers" class="md-nav__link">
    <span class="md-ellipsis">
      Controllers
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Controllers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#namespace-controller" class="md-nav__link">
    <span class="md-ellipsis">
      Namespace Controller
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deployment-checklist_2" class="md-nav__link">
    <span class="md-ellipsis">
      Deployment Checklist
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ontap-cvo-controller" class="md-nav__link">
    <span class="md-ellipsis">
      Ontap CVO controller
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deployment-checklist_3" class="md-nav__link">
    <span class="md-ellipsis">
      Deployment Checklist
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mutating-webhook" class="md-nav__link">
    <span class="md-ellipsis">
      Mutating Webhook
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Mutating Webhook">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deployment-checklist_4" class="md-nav__link">
    <span class="md-ellipsis">
      Deployment Checklist
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-ui" class="md-nav__link">
    <span class="md-ellipsis">
      The UI
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#behaviour-of-the-ecosystem" class="md-nav__link">
    <span class="md-ellipsis">
      Behaviour of the Ecosystem
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#diagram-of-the-ecosystem" class="md-nav__link">
    <span class="md-ellipsis">
      Diagram of the Ecosystem
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#unique-terminology" class="md-nav__link">
    <span class="md-ellipsis">
      Unique Terminology
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Unique Terminology">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#shares" class="md-nav__link">
    <span class="md-ellipsis">
      Shares
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Resources
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Resources
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../resources/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../developer-tools/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Developer Tools
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../resources/networking/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Networking
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#what-is-netapp-in-relation-to-our-legacy-filers" class="md-nav__link">
    <span class="md-ellipsis">
      What is NetApp in relation to our legacy filers?
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#integration-with-netapp" class="md-nav__link">
    <span class="md-ellipsis">
      Integration with NetApp
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Integration with NetApp">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#why-do-we-need-to-modify-goofys" class="md-nav__link">
    <span class="md-ellipsis">
      Why do we need to modify goofys?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deployment-checklist" class="md-nav__link">
    <span class="md-ellipsis">
      Deployment Checklist
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-metafuse-daemonset-and-driver" class="md-nav__link">
    <span class="md-ellipsis">
      The metafuse daemonset and driver
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deployment-checklist_1" class="md-nav__link">
    <span class="md-ellipsis">
      Deployment checklist
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#controllers" class="md-nav__link">
    <span class="md-ellipsis">
      Controllers
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Controllers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#namespace-controller" class="md-nav__link">
    <span class="md-ellipsis">
      Namespace Controller
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deployment-checklist_2" class="md-nav__link">
    <span class="md-ellipsis">
      Deployment Checklist
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ontap-cvo-controller" class="md-nav__link">
    <span class="md-ellipsis">
      Ontap CVO controller
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deployment-checklist_3" class="md-nav__link">
    <span class="md-ellipsis">
      Deployment Checklist
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mutating-webhook" class="md-nav__link">
    <span class="md-ellipsis">
      Mutating Webhook
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Mutating Webhook">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deployment-checklist_4" class="md-nav__link">
    <span class="md-ellipsis">
      Deployment Checklist
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-ui" class="md-nav__link">
    <span class="md-ellipsis">
      The UI
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#behaviour-of-the-ecosystem" class="md-nav__link">
    <span class="md-ellipsis">
      Behaviour of the Ecosystem
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#diagram-of-the-ecosystem" class="md-nav__link">
    <span class="md-ellipsis">
      Diagram of the Ecosystem
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#unique-terminology" class="md-nav__link">
    <span class="md-ellipsis">
      Unique Terminology
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Unique Terminology">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#shares" class="md-nav__link">
    <span class="md-ellipsis">
      Shares
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="netapp-or-filer-mounting">Netapp or "Filer" Mounting<a class="headerlink" href="#netapp-or-filer-mounting" title="Permanent link">&para;</a></h1>
<h2 id="what-is-netapp-in-relation-to-our-legacy-filers">What is NetApp in relation to our legacy filers?<a class="headerlink" href="#what-is-netapp-in-relation-to-our-legacy-filers" title="Permanent link">&para;</a></h2>
<p>Netapp CVO ONTAP is the solution on which our legacy filers moved to.</p>
<hr />
<h2 id="integration-with-netapp">Integration with NetApp<a class="headerlink" href="#integration-with-netapp" title="Permanent link">&para;</a></h2>
<p>Our integration with the cloud volumes relies on the use of the <a href="https://github.com/pfnet-research/meta-fuse-csi-plugin/tree/main">meta-fuse-csi-plugin</a> and is deployed and persisted in gitlab argocd manifests under <code>raw-manifests/netapp/metafuse-driver.yaml</code>. We keep a copy of the meta-fuse-csi-plugin in our <a href="https://github.com/StatCan/goofys/tree/master/meta-fuse-csi-plugin">goofys fork</a> as we must modify the underlying <code>goofys</code> image and having it in one repository greatly simplifies deployment.</p>
<h3 id="why-do-we-need-to-modify-goofys">Why do we need to modify goofys?<a class="headerlink" href="#why-do-we-need-to-modify-goofys" title="Permanent link">&para;</a></h3>
<p>We need to increase the data threshold at which <code>multi-part</code> upload (multi-part upload is not a supported S3 call by our netapp solution) is performed.
In <code>goofys</code> the line we need to make a change to is <a href="https://github.com/kahing/goofys/blob/350ff312abaa1abcf21c5a06e143c7edffe9e2f4/internal/file.go#L202">here</a>, where I just did <a href="https://github.com/Jose-Matsuda/goofys/blob/a1fb9da08cf7fdeec2c72d7f83f3f1ed03e71106/internal/file.go#L244"><code>size = 5000 * 1024 * 1024</code></a>.</p>
<h3 id="deployment-checklist">Deployment Checklist<a class="headerlink" href="#deployment-checklist" title="Permanent link">&para;</a></h3>
<p>For deploying our modified goofys image we just need to make changes to the <code>filer-sidecar-injector</code> configmap, since that determines which metafuse goofys image we use. You can find it in the <a href="https://gitlab.k8s.cloud.statcan.ca/business-transformation/aaw/aaw-argocd-manifests/-/blob/das-dev-cc-00/raw-manifests/netapp/configmap.yaml?ref_type=heads#L15">raw-manifests/netapp/configmap.yaml</a> in the argocd-manifests gitlab repo.
After updating this you will need to synch up argo to load this new configmap into the cluster, and then restart the filer-sidecar-injector to pick up the new configuration.</p>
<h3 id="the-metafuse-daemonset-and-driver">The metafuse daemonset and driver<a class="headerlink" href="#the-metafuse-daemonset-and-driver" title="Permanent link">&para;</a></h3>
<p>We need to use a custom plugin as noted <a href="https://github.com/pfnet-research/meta-fuse-csi-plugin?tab=readme-ov-file#deploy-plugin">in the documentation here</a>. For this, we'd need to build <a href="https://github.com/pfnet-research/meta-fuse-csi-plugin/blob/main/cmd/csi_driver/Dockerfile">this dockerfile</a> and then deployed with this <a href="https://github.com/pfnet-research/meta-fuse-csi-plugin/tree/main/deploy">yaml</a></p>
<h3 id="deployment-checklist_1">Deployment checklist<a class="headerlink" href="#deployment-checklist_1" title="Permanent link">&para;</a></h3>
<p>This is deployed in the gitlab argocd manifests under <a href="https://gitlab.k8s.cloud.statcan.ca/business-transformation/aaw/aaw-argocd-manifests/-/blob/das-prod-cc-00/raw-manifests/netapp/metafuse-driver.yaml?ref_type=heads">raw-manifests/netapp/metafuse-driver.yaml</a></p>
<hr />
<h2 id="controllers">Controllers<a class="headerlink" href="#controllers" title="Permanent link">&para;</a></h2>
<p>There are <strong>two</strong> controllers that this feature requires. The first is to add <code>labels</code> to the namespace as that is what the <code>mutatingwebhook</code> uses in order to inject the filer sidecar spec into created notebook pods. The second is to automatically generate secrets based on values in a user configmap.</p>
<h3 id="namespace-controller"><a href="https://github.com/StatCan/aaw-kubeflow-profiles-controller/blob/profiles-controller-aaw2.0/cmd/namespace.go">Namespace Controller</a><a class="headerlink" href="#namespace-controller" title="Permanent link">&para;</a></h3>
<p>This controller is built off of the existing <code>aaw-kubeflow-profiles-controller</code> and is simple. It uses the same built image that the other controllers use, with the exception that the startup command is <code>namespace</code> to run this controller. The tracking issue for this controller is <a href="https://jirab.statcan.ca/browse/BTIS-332">BTIS-332</a> with more details.
All this does is watch profiles, and  then for that profile's generated namespace, if it does not have the label listed in <code>newLabels</code>, then in adds it. In this case it adds <code>filer-sidecar-injection: enabled</code>.</p>
<h3 id="deployment-checklist_2">Deployment Checklist<a class="headerlink" href="#deployment-checklist_2" title="Permanent link">&para;</a></h3>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Make changes to the <a href="https://github.com/StatCan/aaw-kubeflow-profiles-controller/tree/profiles-controller-aaw2.0">aaw-kubeflow-profiles-controller</a> repo on github and push and let the workflow push the image</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Modify the <code>profiles-controller</code> branch in the <a href="https://gitlab.k8s.cloud.statcan.ca/cloudnative/statcan/charts/-/tree/profiles-controller?ref_type=heads"><code>statcan/charts</code></a> gitlab repository, modifying any new permissions needed, updating the tag, or adding a new controller</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Modify the <code>profiles-controller.yaml</code> tag in the argocd-manifests repo.</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Sync the respective <code>root</code> application in argocd, for example for prod you need to sync the <code>das-prod-cc-00-root</code> application for everything to come up.</li>
</ul>
<h3 id="ontap-cvo-controller"><a href="https://github.com/StatCan/aaw-kubeflow-profiles-controller/blob/profiles-controller-aaw2.0/cmd/ontap-cvo.go">Ontap CVO controller</a><a class="headerlink" href="#ontap-cvo-controller" title="Permanent link">&para;</a></h3>
<p>This controller is responsible for managing what buckets that a user has access to, as well as creating the secrets associated with a user and all that comes with it. The bucket that is created uses a <em>hashed</em> version of the inputted request path in order to comply with naming conventions and to avoid collision. This controller uses a configmap that the user generates from the UI that requests certain paths in an SVM (in this case an SVM is equivalent to a filer ex fld9filer). Using that configmap, API calls are sent off to the following; current Kubernetes cluster, Microsoft Graph, Ontap.</p>
<p>The current kubernetes cluster is used for the following
- Determine whether or not a user secret exists for an svm, and submit a create if needed.
- Create and modify the end <code>existing-shares</code> configmap, which is used by the filer-sidecar-injector.
- Creating and modifying the <code>shares-errors</code> configmap, which shows errors to the user.
- Grabbing data from the <code>filers-list</code> configmap and the secrets needed to interact with the Microsoft Graph Api and Ontap.</p>
<p>The Microsoft Graph API is used to get the onpremises name, as the username that the user has in the Netapp system matters as that is how the mapping of permissions is done. </p>
<p>The Ontap API we query to;
- Determine if a user exists S3 side, if not we will create it.
- Check if a user group exists, if yes add the current user, if not create it and add the user. 
- Retrieve the actual <code>nas_path</code>. This is because the user inputted path will be different from what is actually on the Netapp system and we need that <code>path</code> else our request to create the bucket will error out. We get this from the <a href="#shares">shares level</a>
- Determine if a bucket at the user requested path exists, if not create it</p>
<p>A TLDR;</p>
<p>User selects and inputs a path in a filer they want access to via the UI which then creates a configmap. This controller picks up that configmap and checks if a user for that filer exists using the onpremname from the graph api, if not creates and assigns it the correct policy to interact with it. The controller then hashes the user inputted filer path to a bucket name and then we check if that bucket exists, if it does not create it.
The controller then cleans up and creates or modifies the <code>existing-shares</code> configmap which is used by the filer-sidecar-injector.</p>
<p>For more details on how this controller works, please refer to the <a href="https://github.com/StatCan/aaw-kubeflow-profiles-controller/blob/profiles-controller-aaw2.0/ontap-cvo.md">README</a></p>
<h3 id="deployment-checklist_3">Deployment Checklist<a class="headerlink" href="#deployment-checklist_3" title="Permanent link">&para;</a></h3>
<p>This is currently built off of the <code>profiles-controller</code> so the deployment here is the same as the <a href="#namespace-controller">namespace controller</a> above. Just make sure that you are on the <a href="https://github.com/StatCan/aaw-kubeflow-profiles-controller/tree/profiles-controller-aaw2.0">profiles-controller-aaw2.0 branch</a></p>
<hr />
<h2 id="mutating-webhook"><a href="https://github.com/StatCan/filer-sidecar-injector">Mutating Webhook</a><a class="headerlink" href="#mutating-webhook" title="Permanent link">&para;</a></h2>
<p>The filer-sidecar-injector repo is a mutatingwebhook that injects sidecar configuration for notebook pods.
For more in-depth information of how the mutating webhook works, its best to reference the <a href="https://github.com/morvencao/kube-sidecar-injector">upstream repo</a> with more details in the <a href="https://medium.com/ibm-cloud/diving-into-kubernetes-mutatingadmissionwebhook-6ef3c5695f74">medium article</a></p>
<p>The main modifications were made to the <code>createPatch</code> function as instead of just having a single sidecar container, we had to loop as there is a possibility of a user having access to more than one filer. A configmap is used as a template, and then deep copied so that we can use it repeatedly when generating the spec to be <code>patch</code>ed to the pod resource that is being created.</p>
<p>The <code>sidecar</code> that we are inserting is the custom goofys metafuse image that comes from <a href="https://github.com/StatCan/goofys/blob/a4aa306ca63e4dd0d4bf4c903c270efc75f0ae1e/Dockerfile#L1">our statcan repo</a>. This sidecar image drives the connection to the filers and as part of the patch we also update the working volume mounts for the user image (jupyterlab notebook) so that they can interact with their filers.</p>
<p>For more details refer to the <a href="https://github.com/StatCan/filer-sidecar-injector/blob/master/README.md">README</a></p>
<h3 id="deployment-checklist_4">Deployment Checklist<a class="headerlink" href="#deployment-checklist_4" title="Permanent link">&para;</a></h3>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Build the image in <code>filer-sidecar-injector</code> and push to our acr.</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Update the image tag in the deployment in the argocd manifests repo.</li>
</ul>
<h2 id="the-ui">The UI<a class="headerlink" href="#the-ui" title="Permanent link">&para;</a></h2>
<p>As referenced above, the user creates their <code>requesting-shares</code> configmap via a the manage-filers page component in <a href="https://github.com/StatCan/kubeflow/tree/kubeflow-aaw2.0/components/centraldashboard">centraldashboard</a>.
The manage-filers page is responsible for the following tasks;
- Gets the data to populate the dropdown from the <code>filers-list</code> CM in the das namespace
- Gets the data to fill out the tables to display from the user's namespace, in the CMs <code>requesting-shares</code> and <code>existing-shares</code>
- The submit button adds a new entry to the <code>requesting-shares</code> CM, which gets ingested by the ontap-controller
- Users can delete entries from the <code>existing-shares</code> CM, which is the CM ingested by the filer-sidecar-injector
- Display any errors from the <code>shares-errors</code> CM, which gets populated by the ontap-controller when an error occurs during the <code>requesting-shares</code> ingestion</p>
<hr />
<h2 id="behaviour-of-the-ecosystem">Behaviour of the Ecosystem<a class="headerlink" href="#behaviour-of-the-ecosystem" title="Permanent link">&para;</a></h2>
<p>User logs in and creates their profile, the <a href="#namespace-controller">Namespace Controller</a> then adds the label for the <a href="#mutating-webhook">mutatingwebhook</a>.
The user then manages their filers in the UI which creates a configmap that the <a href="#ontap-cvo-controller">ontap-cvo controller</a> consumes to create the secrets and configmaps necessary for the <a href="#mutating-webhook">mutating webhook</a> to mount user requested filer paths to running notebook pods.</p>
<h2 id="diagram-of-the-ecosystem">Diagram of the Ecosystem<a class="headerlink" href="#diagram-of-the-ecosystem" title="Permanent link">&para;</a></h2>
<p><img alt="Image of ecosystem" src="../NetAppEcosys.png" /></p>
<hr />
<h2 id="unique-terminology">Unique Terminology<a class="headerlink" href="#unique-terminology" title="Permanent link">&para;</a></h2>
<h3 id="shares">Shares<a class="headerlink" href="#shares" title="Permanent link">&para;</a></h3>
<p>In Ontap CVO, we have something known as <code>shares</code>. This is what our controller interacts and uses when determining where to place the user requested path. 
Broadly speaking to get to the <code>share</code> level we have to go through an <code>SVM</code>, which for us tends to be represented as the field or sas filer, as in fld9filersvm. After that there is the <code>volume</code> associated with that <code>SVM</code>. With that <code>volume</code> there is a <code>QTree</code> associated with that and then finally a <code>share</code> with the <code>QTree</code> as in</p>
<p><code>SVM -&gt; Volume -&gt; Qtree -&gt; Share</code></p>
<p>Where <code>share</code> is what we have access to and helps to determine the path in the ontap cvo solution that we need the user requested filer path (that they get from their avd) to be associated to.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2020 Statistics Canada
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/StatCan/aaw" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1M480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2m-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3m-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://statcan-aaw.slack.com" target="_blank" rel="noopener" title="statcan-aaw.slack.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M94.12 315.1c0 25.9-21.16 47.06-47.06 47.06S0 341 0 315.1s21.16-47.06 47.06-47.06h47.06zm23.72 0c0-25.9 21.16-47.06 47.06-47.06s47.06 21.16 47.06 47.06v117.84c0 25.9-21.16 47.06-47.06 47.06s-47.06-21.16-47.06-47.06zm47.06-188.98c-25.9 0-47.06-21.16-47.06-47.06S139 32 164.9 32s47.06 21.16 47.06 47.06v47.06zm0 23.72c25.9 0 47.06 21.16 47.06 47.06s-21.16 47.06-47.06 47.06H47.06C21.16 243.96 0 222.8 0 196.9s21.16-47.06 47.06-47.06zm188.98 47.06c0-25.9 21.16-47.06 47.06-47.06S448 171 448 196.9s-21.16 47.06-47.06 47.06h-47.06zm-23.72 0c0 25.9-21.16 47.06-47.06 47.06s-47.06-21.16-47.06-47.06V79.06c0-25.9 21.16-47.06 47.06-47.06s47.06 21.16 47.06 47.06zM283.1 385.88c25.9 0 47.06 21.16 47.06 47.06S309 480 283.1 480s-47.06-21.16-47.06-47.06v-47.06zm0-23.72c-25.9 0-47.06-21.16-47.06-47.06s21.16-47.06 47.06-47.06h117.84c25.9 0 47.06 21.16 47.06 47.06s-21.16 47.06-47.06 47.06z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": [], "search": "../../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.83f73b43.min.js"></script>
      
        <script src="../../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>